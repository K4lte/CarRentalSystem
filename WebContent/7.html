<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="style/modal.css" type="text/css"/>
    <link href="style/style0.css" rel="stylesheet">
    
<style>
#reservations {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 70%;
}

#reservations td, #reservations th {
  border: 1px solid #ddd;
  padding: 8px;
}

#reservations tr:nth-child(even){background-color: #f2f2f2;}

#reservations tr:hover {background-color: #ddd;}

#reservations th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: center;
  background-color: #52af2b;
  color: white;
  }

  input[type=button] {
			background-color: #4CAF50;
			color: white;
			padding: 14px 20px;
			margin: 2px 0;
			border: none;
			cursor: pointer;

		}

  div {
			margin: 0 auto;
            border-radius: 5px;
            padding: 10px;

        }

table {
    margin-left: auto;
    margin-right: auto;
}

.holderInCenter{ 
			text-align: center; 
			}
</style>

    <meta charset="UTF-8">
    <title>Rental Cars</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link href="style/style0.css" rel="stylesheet">
</head>
<body onload='warning()'>

<div class="wrapper">

    <header class="header">
        <div class="holderInCenter">
            <input type="button" value="Show Reservations" onclick="showAllReservations()">
            <input type="button" value="Search for a car" onclick="search()">

        </div>
    </header><!-- .header-->

   
    <div class="middle" id="middle">
        <br>
        <div id="reservations"></div>

            
    </div><!-- .middle-->

</div><!-- .wrapper -->




<footer class="footer">
    <strong>Footer:</strong>
</footer><!-- .footer -->

</body>

<script type="text/javascript" src="js/common.js" defer></script>

<script type="text/javascript">
var parsedJSON;
var statusMonitoringId;
var action = "reservation_client_monitoring";
var actionWarning = "reservation_client_warning";

function showAllReservations(){
        //to empty DOM elements
    clear();
    showReservations(action);
}

function warning(){
    showReservations("reservation_client_warning");
}

// Function to show all reservations with selected status. Part 1
function showReservations(action) { 
    var request = CreateRequest();
    request.open("POST", action, true); 
   	request.onreadystatechange = function () {
	    if (request.readyState == 4) {
            if (request.status == 200){
           	    showReservationTable(request);
		    } else {
            	document.write("Server's response " + request.status);      
            }
        }
    };
    request.send(null);
 }
 

 // Function to create tables in the html page
function showReservationTable(request){
	parsedJSON = JSON.parse(request.responseText);
    let div = document.getElementById("reservations");
	
	for (let i = 0; i < parsedJSON.length; i++) {
		// creates a <table> element 
		let table = document.createElement("table");
		//table.setAttribute("border", "1px solid black");
		table.setAttribute("id", "reservation" + i);
        let row = table.insertRow(0);
        let th = document.createElement('th');
        th.setAttribute("colspan", "2");
        th.innerHTML = "Number: " + parsedJSON[i].uniqueNumber;         
        row.appendChild(th);
   		// 1st row
        row = table.insertRow(1);  
        cell = row.insertCell(0);
        cell.innerHTML = "Car"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].car.brand.brandName + " " + parsedJSON[i].car.model; 
        // 2nd row
        row = table.insertRow(2); 
        cell = row.insertCell(0);
        cell.innerHTML = "Client"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].client.lastName + " " + parsedJSON[i].client.firstName; 
        // 3th row           
        row = table.insertRow(3);
        cell = row.insertCell(0);
        cell.innerHTML = "Pick Up Date"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].pickUpDate; 
        // 4th row
        row = table.insertRow(4);
        cell = row.insertCell(0);
        cell.innerHTML = "Drop Off Date"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].returnDate; 
        // 5th row
        row = table.insertRow(5);
        cell = row.insertCell(0);
        cell.innerHTML = "Pick Up Location"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].pickUpLocation.location.city.cityName + ", " + parsedJSON[i].pickUpLocation.location.address; 
        // 6th row
        row = table.insertRow(6);
        cell = row.insertCell(0);
        cell.innerHTML = "Drop Off Location"; 
        cell = row.insertCell(1);
        cell.innerHTML = parsedJSON[i].returnLocation.location.city.cityName + ", " + parsedJSON[i].returnLocation.location.address;     
        // 7th row
		row = table.insertRow(7);
		cell = row.insertCell(0);
		cell.innerHTML = "Status";
		cell = row.insertCell(1);
        let status = parsedJSON[i].status.statusName;
        cell.innerHTML = status;
        
        if (status == "damaged" ) {
            th.setAttribute("style", "background-color:tomato;");

            // 8th row
            row = table.insertRow(8);
            let td = document.createElement('td');
            td.setAttribute("colspan", "2");
            td.setAttribute("align", "center");
            row.appendChild(td);
            // create a button
            let buttonPay = document.createElement("input");
            buttonPay.setAttribute('type', "button");
            buttonPay.setAttribute('value', "Pay");
            buttonPay.setAttribute('id', i);
            buttonPay.setAttribute('onclick', "pay(" + i + ")");
            td.appendChild(buttonPay);
            // create hiddenId
            let hiddenId = document.createElement("input");
            hiddenId.setAttribute('type', "hidden");
            hiddenId.setAttribute('name', "hiddenId");
            hiddenId.setAttribute('value', parsedJSON[i].id);
            table.appendChild(hiddenId);
        }       
		
		//create a div
		let divInner = document.createElement("div");
		divInner.setAttribute('id',"div" + i);
        divInner.setAttribute("class", "tables");
		divInner.appendChild(table);		
		let br = document.createElement("br");
		divInner.appendChild(br);
		div.appendChild(divInner);
	}	
    //setStatus("innerSelect");
}

// Function to pay for damage
function pay(jsonId){
    let actionDamage = "damage_not_paid";
    let reservationId = "reservationId=" + parsedJSON[jsonId].id;
    var request = CreateRequest();
    request.open("POST", actionDamage, true); 
    //Send the proper header information along with the request
    request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    request.onreadystatechange = function () {
        if (request.readyState == 4) {
            if (request.status == 200){
                if (request.responseText == "Success")
                window.location.href = "4.html";
            }
        }
    };
    request.send(reservationId);
}

function clear(){
    let divs = document.querySelectorAll("div.tables");
    for (let i=0; i<divs.length; i++){
        while (divs[i].firstChild) {
            divs[i].removeChild(divs[i].firstChild);
        }
    }
}

function search(){
    window.location.href = "1.html";
}
</script>

</html>